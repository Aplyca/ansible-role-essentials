---
- name: Upgrade the system
  sudo: yes
  yum:
    name: "*"
    state: latest
  when: essentials["upgrade"] is defined and essentials["upgrade"]
    
- name: Ensure essentials packages are present using yum
  sudo: yes
  yum:
    name: "{{ item }}"
    state: present
  with_items: essentials["packages"]

- name: Add custom timezone
  sudo: yes
  command: "sudo timedatectl set-timezone {{ essentials['timezone'] | default('Etc/UTC') }}"
  changed_when: False

- name: Disable SELInux
  sudo: yes
  selinux:
    state: "{{ essentials['selinux'] }}"
  when: essentials['selinux'] is defined
