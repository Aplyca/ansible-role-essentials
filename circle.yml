
general:
  build_dir: tests

dependencies:
  pre:
    - sudo pip install paramiko PyYAML jinja2 httplib2
    - sudo pip install ansible

machine:
  environment:
    PLAYBOOK: playbook.yml

test:
  pre:
    - sudo ln -s ansible-role-essentials ../../mauricios.Essentials
  override:
    # Install dependencies
    - ansible-galaxy install -r dependencies.txt
    - ansible-playbook $PLAYBOOK --syntax-check
    - ansible-playbook $PLAYBOOK --connection=local
    - "ansible-playbook $PLAYBOOK --connection=local | grep -q 'changed=0.*failed=0' && (echo 'Idempotence test: pass' && exit 0) || (echo 'Idempotence test: fail' && exit 1)"
    - lynx --version
    - git --version
    - wget --version
    - "env x='() { :;}; echo vulnerable' bash -c 'echo hello' | grep -q 'vulnerable' && (echo 'Shellshock test: pass' && exit 0) || (echo 'Shellshock test: fail' && exit 1)"
    - "date | grep -q 'EDT' && (echo 'Date test: pass' && exit 0) || (echo 'Date test: fail' && exit 1)"
